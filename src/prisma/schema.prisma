// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id String @id @default(uuid())
  username String
  password String
  firstName String
  lastName String
  role UserRole
  orders Order[]
}

model Table {
  id      String @id @default(uuid())
  numberOfSeats Int
  tableNumber Int @unique @default(autoincrement())
  orders Order[]
  state TableState
}

model Customer {
  id String @id @default(uuid())
  type CustomerType
  bookedCustomer BookedCustomer?
  newCustomer NewCustomer?
  orders Order[]
}

model BookedCustomer {
  phoneNumber String
  firstName String
  lastName String
  customer Customer @relation(fields: [customerId],references: [id])
  customerId String
  @@id([customerId])
}

model NewCustomer {
  ordinamNumber Int
  date DateTime
  customer Customer @relation(fields: [customerId],references: [id])
  customerId String
  @@id([customerId])
  @@unique([ordinamNumber, date])
}

model Order {
  id String @id @default(uuid())
  arrivalTime DateTime
  leavingTime DateTime
  state String
  paymentMethod PaymentMethod
  orderItems OrderItem[]
  totalCost Int
  totalDiscount Float
  table Table @relation(fields: [tableId], references: [id])
  tableId String
  customer Customer @relation(fields: [customerId], references: [id])
  customerId String
  employee User @relation(fields: [employeeId], references: [id])
  employeeId String
}

model OrderItem{
  price Int
  discount Float
  totalQuantity Int
  servedQuantity Int
  state OrderItemState
  order Order @relation(fields: [orderId], references: [id])
  orderId String
  foodItem FoodItem @relation(fields: [foodItemId], references: [id])
  foodItemId String
  @@id([orderId, foodItemId])
}

model FoodItem {
  id String @id @default(uuid())
  name String
  description String
  category String
  price Int
  discount Float
  images Image[]
  orderItems OrderItem[]
}

model Image {
  id String @id @default(uuid())
  url String
  foodItem FoodItem @relation(fields: [foodItemId], references: [id])
  foodItemId String
  numberOfOrder Int
  price Int
  discount Float
}

// enum
enum UserRole {
  CLERK
  MANAGER
  ADMIN
}

enum CustomerType {
  NEW
  BOOKED
}

enum TableState {
  FREE
  LOCKED
  INPROGRESS
}

enum PaymentMethod {
  ONLINE
  OFFLINE
}

enum OrderItemState {
  INIT
  CALLED
  SERVING
  SERVED
}



